<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Welcome to climatePy â€¢ climateR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Welcome to climatePy">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">climateR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.7</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mikejohnson51/climateR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Welcome to climatePy</h1>
                        <h4 data-toc-skip class="author">Angus
Watters</h4>
            <address class="author_afil">
      Lynker<br><h4 data-toc-skip class="author">Mike
Johnson</h4>
            <address class="author_afil">
      Lynker<br><small class="dont-index">Source: <a href="https://github.com/mikejohnson51/climateR/blob/HEAD/vignettes/intro-climatepy.Rmd" class="external-link"><code>vignettes/intro-climatepy.Rmd</code></a></small>
      <div class="d-none name"><code>intro-climatepy.Rmd</code></div>
    </address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="useful-packages-for-climate-data">Useful Packages for climate data<a class="anchor" aria-label="anchor" href="#useful-packages-for-climate-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># climatePy</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> climatePy</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># vector data libs</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="im">import</span> shapely</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co"># gridded data libs</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># geoencoding service </span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="im">import</span> geopy</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># misc</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co"># plotting libs</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="climatepy-examples">climatePy examples<a class="anchor" aria-label="anchor" href="#climatepy-examples"></a>
</h2>
<p>The <code>climatePy</code> package is supplemented by the <a href="https://github.com/geopy/geopy" class="external-link">geopy</a> Python package which
allows for an easy to use interface for many geocoding APIs.</p>
<p>To get a climate product, an area of interest must be defined:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># get AOI polygon from OpenStreetMap API</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>nom <span class="op">=</span> geopy.geocoders.Nominatim(user_agent<span class="op">=</span><span class="st">"climatePy"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>geolocal <span class="op">=</span> nom.geocode(<span class="st">"North Carolina"</span>, geometry<span class="op">=</span><span class="st">'wkt'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>AOI <span class="op">=</span> gpd.GeoDataFrame(</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  {<span class="st">"geometry"</span> : [shapely.wkt.loads(geolocal.raw[<span class="st">'geotext'</span>])]</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>  }, </span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="../reference/figures/nc_shape.jpg" width="100%" style="display: block; margin: auto;"></p>
<p>Here we are loading a polygon for the state of North Carolina More
examples of constructing AOI calls can be found <a href="https://geopy.readthedocs.io/en/stable/#module-geopy.geocoders" class="external-link">here</a></p>
<p>With an AOI, we can construct a call to a dataset for a parameter(s)
and date(s) of choice. Here we are querying the PRISM dataset for
maximum and minimum temperature on October 29, 2018:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>p <span class="op">=</span> climatePy.getPRISM(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>   AOI       <span class="op">=</span> AOI, </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>   varname   <span class="op">=</span> [<span class="st">'tmax'</span>,<span class="st">'tmin'</span>], </span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>   startDate <span class="op">=</span> <span class="st">"2018-10-29"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>   timeRes   <span class="op">=</span> <span class="st">"daily"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>   dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>   )</span></code></pre></div>
<p><img src="../reference/figures/nc_prism_data.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="data-from-known-bounding-coordinates">Data from known bounding coordinates<a class="anchor" aria-label="anchor" href="#data-from-known-bounding-coordinates"></a>
</h2>
<p><code>climatePy</code> offers support for <code>shapely</code> and
<code>geopandas</code> objects. Here we are requesting wind velocity
data for the four corners region of the USA by bounding coordinates.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># 4 corners region of USA</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>xmin, xmax, ymin, ymax <span class="op">=</span> <span class="op">-</span><span class="dv">112</span>, <span class="op">-</span><span class="dv">105</span>, <span class="dv">34</span>, <span class="dv">39</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co"># make bounding box</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>AOI <span class="op">=</span> box(xmin, ymin, xmax, ymax)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># insert bounding box into geodataframe</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co"># AOI = gpd.GeoDataFrame(geometry=[AOI], crs ='EPSG:4326')</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>g <span class="op">=</span> climatePy.getGridMET(</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a>       AOI       <span class="op">=</span> AOI, </span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a>       varname   <span class="op">=</span> <span class="st">"vs"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a>       startDate <span class="op">=</span> <span class="st">"2018-09-01"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a>       dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a>       )</span></code></pre></div>
<p><img src="../reference/figures/nc_tmin_tmax_gridmet.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="data-through-time">Data through time â€¦<a class="anchor" aria-label="anchor" href="#data-through-time"></a>
</h2>
<p>In addition to multiple variables we can request variables through
time, here letâ€™s look at the gridMET rainfall for the Gulf Coast during
Hurricane Harvey:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>texas   <span class="op">=</span> nom.geocode(<span class="st">"Texas"</span>, geometry<span class="op">=</span><span class="st">'wkt'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>florida <span class="op">=</span> nom.geocode(<span class="st">"Florida"</span>, geometry<span class="op">=</span><span class="st">'wkt'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>AOI     <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="st">"geometry"</span> : [shapely.wkt.loads(texas.raw[<span class="st">'geotext'</span>]), shapely.wkt.loads(florida.raw[<span class="st">'geotext'</span>])]</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  }, </span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>harvey <span class="op">=</span> climatePy.getGridMET(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  AOI       <span class="op">=</span> AOI,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  varname   <span class="op">=</span> <span class="st">"pr"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2017-08-20"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  endDate   <span class="op">=</span> <span class="st">"2017-08-31"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="../reference/figures/harvey_pr_gridmet.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="climate-projections">Climate Projections<a class="anchor" aria-label="anchor" href="#climate-projections"></a>
</h2>
<p>Some sources are downscaled Global Climate Models (GCMs). These allow
you to query forecasted ensemble members from different models and/or
climate scenarios. One example is from the MACA dataset:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>AOI <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="st">"geometry"</span> : [shapely.wkt.loads(florida.raw[<span class="st">'geotext'</span>])]}, </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>m <span class="op">=</span> climatePy.getMACA(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  AOI       <span class="op">=</span> AOI,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  model     <span class="op">=</span> <span class="st">"CCSM4"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  varname   <span class="op">=</span> <span class="st">"pr"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  scenario  <span class="op">=</span> [<span class="st">"rcp45"</span>, <span class="st">"rcp85"</span>],</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2080-06-29"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  endDate   <span class="op">=</span> <span class="st">"2080-06-30"</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="../reference/figures/florida_multi_model_maca.jpg" width="100%" style="display: block; margin: auto;"></p>
<p>Getting multiple models results is also quite simple:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>AOI     <span class="op">=</span> gpd.GeoDataFrame({<span class="st">"geometry"</span> : </span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>                [shapely.wkt.loads(nom.geocode(<span class="st">"Colorado"</span>, geometry<span class="op">=</span><span class="st">'wkt'</span>).raw[<span class="st">'geotext'</span>])]},</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>                crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>                )</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>models <span class="op">=</span> [<span class="st">"BNU-ESM"</span>,<span class="st">"CanESM2"</span>, <span class="st">"CCSM4"</span>]</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>temp <span class="op">=</span> climatePy.getMACA(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  AOI       <span class="op">=</span> AOI,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  varname   <span class="op">=</span> <span class="st">"tasmin"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  model <span class="op">=</span> models,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2080-11-29"</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  )</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  </span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co"># calculate average Data Array</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>avg <span class="op">=</span> temp[<span class="st">'tasmin'</span>].mean(dim <span class="op">=</span> <span class="st">"time"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>avg <span class="op">=</span> avg.expand_dims(time <span class="op">=</span> xr.DataArray([<span class="st">"tasmin_Ensemble_mean"</span>], dims<span class="op">=</span><span class="st">'time'</span>)).transpose(<span class="st">'x'</span>, <span class="st">'y'</span>, <span class="st">'time'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co"># Concatonate original data arrays with average data array</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>temp[<span class="st">'tasmin'</span>] <span class="op">=</span> xr.concat([temp[<span class="st">'tasmin'</span>], avg], dim<span class="op">=</span><span class="st">"time"</span>)</span></code></pre></div>
<p><img src="../reference/figures/colorado_model_avg_maca.jpg" width="100%" style="display: block; margin: auto;"></p>
<p>If you donâ€™t know your models, you can always grab a random set by
specifying a number:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># AOI (Michigan, USA)</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>AOI     <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="st">"geometry"</span> : [shapely.wkt.loads(nom.geocode(<span class="st">"Michigan, USA"</span>, geometry<span class="op">=</span><span class="st">'wkt'</span>).raw[<span class="st">'geotext'</span>])]</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  },</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co"># get 3 random MACA models</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>random_models <span class="op">=</span> climatePy.getMACA(</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  AOI       <span class="op">=</span> AOI,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  model     <span class="op">=</span> <span class="dv">3</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  varname   <span class="op">=</span> <span class="st">"tasmin"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2050-10-29"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="../reference/figures/michigan_random_maca.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="global-datasets">Global Datasets<a class="anchor" aria-label="anchor" href="#global-datasets"></a>
</h2>
<p>Not all datasets are USA focused either. TerraClimate offers global,
monthly data up to the current year for many variables, and CHIRPS
provides daily rainfall data:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>kenya     <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="st">"geometry"</span> : [shapely.wkt.loads(nom.geocode(<span class="st">"Kenya"</span>, geometry<span class="op">=</span><span class="st">'wkt'</span>).raw[<span class="st">'geotext'</span>])]</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  }, </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># TerraClim PET</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>tc <span class="op">=</span> climatePy.getTerraClim(</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  AOI       <span class="op">=</span> kenya,</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  varname   <span class="op">=</span> <span class="st">"pet"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2018-01-01"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  )</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  </span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co"># CHIRPS precip</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>chirps <span class="op">=</span> climatePy.getCHIRPS(</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  AOI       <span class="op">=</span> kenya,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2018-01-01"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>  endDate   <span class="op">=</span> <span class="st">"2018-01-01"</span>,</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>  dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="../reference/figures/kenya_tc_chirps.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="point-based-data">Point Based Data<a class="anchor" aria-label="anchor" href="#point-based-data"></a>
</h2>
<p>Finally, data gathering is not limited to areal extents and can be
retrieved as a time series at locations.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># Create a DataFrame with 'lng' and 'lat' columns</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'lng'</span>: [<span class="op">-</span><span class="fl">105.0668</span>], <span class="st">'lat'</span>: [<span class="fl">40.55085</span>]})</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>pt <span class="op">=</span> (gpd.GeoDataFrame(geometry<span class="op">=</span>gpd.points_from_xy(df[<span class="st">'lng'</span>], df[<span class="st">'lat'</span>]), crs<span class="op">=</span><span class="st">'EPSG:4326'</span>))</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>ts <span class="op">=</span> climatePy.getGridMET(</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  AOI       <span class="op">=</span> pt,</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  varname   <span class="op">=</span> [<span class="st">"pr"</span>, <span class="st">'srad'</span>],</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2021-01-01"</span>, </span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  endDate   <span class="op">=</span> <span class="st">"2021-12-31"</span>,</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="../reference/figures/point_timeseries_gridmet.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="point-based-ensemble">Point Based Ensemble<a class="anchor" aria-label="anchor" href="#point-based-ensemble"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Point Based Ensemble</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>future <span class="op">=</span> climatePy.getMACA(</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>    AOI       <span class="op">=</span> pt,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>    model     <span class="op">=</span> <span class="dv">5</span>,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>    varname   <span class="op">=</span> <span class="st">"tasmax"</span>, </span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    startDate <span class="op">=</span> <span class="st">"2050-01-01"</span>, </span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    endDate   <span class="op">=</span> <span class="st">"2050-01-31"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    dopar     <span class="op">=</span> <span class="va">False</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="../reference/figures/future_points_maca.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="multi-site-extraction">Multi Site extraction<a class="anchor" aria-label="anchor" href="#multi-site-extraction"></a>
</h2>
<p>Extracting data for a set of points is an interesting challenge. It
turns it is much more efficient to grab the underlying raster stack and
then extract time series as opposed to iterating over the locations:</p>
<ol style="list-style-type: decimal">
<li>Starting with a set of 50 random points in Colorado.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Colorado state polygon</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>AOI     <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="st">"geometry"</span> : [shapely.wkt.loads(nom.geocode(<span class="st">"Colorado"</span>, geometry<span class="op">=</span><span class="st">'wkt'</span>).raw[<span class="st">'geotext'</span>])]</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  }, </span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># create 10 random Lat/lon points within the AOI bounding box</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>points <span class="op">=</span> [shapely.geometry.Point(random.uniform(AOI.bounds.minx[<span class="dv">0</span>], AOI.bounds.maxx[<span class="dv">0</span>]),</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>          random.uniform(AOI.bounds.miny[<span class="dv">0</span>], AOI.bounds.maxy[<span class="dv">0</span>])) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">50</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>          ]</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a><span class="co"># make geopandas dataframe from points</span></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>points_df <span class="op">=</span> gpd.GeoDataFrame(geometry<span class="op">=</span>points, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co"># create a unique identifier column</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>points_df[<span class="st">"uid"</span>] <span class="op">=</span> [<span class="st">"uid_"</span> <span class="op">+</span> <span class="bu">str</span>(i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(points_df))]</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>
<code>climatePy</code> will grab the DataArray underlying the
bounding area of the points</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>sites_stack <span class="op">=</span> climatePy.getTerraClim(</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  AOI       <span class="op">=</span> points_df, </span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  varname   <span class="op">=</span> <span class="st">"tmax"</span>, </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  startDate <span class="op">=</span> <span class="st">"2018-01-01"</span>, </span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  endDate   <span class="op">=</span> <span class="st">"2018-12-31"</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="../reference/figures/terraclim_points_tmax_1200x840.jpg" width="100%" style="display: block; margin: auto;"></p>
<ol start="3" style="list-style-type: decimal">
<li>Use <code>extract_sites</code> to extract the times series from
these locations. The <code>id</code> parameter is the unique identifier
from the site data with which to names the resulting columns.</li>
</ol>
<p>Providing our stack of DataArrays to <code>extract_sites</code> with
our <code>points_df</code> will extract the raster values for each point
across time.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># extract wide sites data</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>sites_wide <span class="op">=</span> climatePy.extract_sites(r <span class="op">=</span> sites_stack[<span class="st">"tmax"</span>], pts <span class="op">=</span> points_df, <span class="bu">id</span> <span class="op">=</span> <span class="st">"uid"</span>)</span></code></pre></div>
<p><img src="../reference/figures/terraclim_points_timeseries.jpg" width="100%" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Johnson, Justin Singh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
